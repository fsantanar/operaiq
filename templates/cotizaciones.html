{% extends 'base.html' %}

{% block title %}Cotizaciones{% endblock %}

{% block content %}
    <h2>Ver Cotizaciones</h2>

    {% if get_flashed_messages() %}
        <div class="mensajes-flash">
            {% for message in get_flashed_messages(with_categories=true) %}
                <div class="alert alert-{{ message[0] }}">{{ message[1] }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Formulario para seleccionar cliente para las cotizaciones -->
    <form method="POST" class="formulario-servicio">
        <label for="cliente_id">Seleccione el Cliente Para el Cual Quiere Administrar Cotizaciones:</label>
        <select name="cliente_id" id="cliente_id" required>
            <option value="" disabled selected>Seleccione un Cliente</option>
            {% for cliente in clientes %}
                <option value="{{ cliente.id }}" {% if cliente.id == cliente_id %} selected {% endif %}>{{ cliente.nombre }}</option>
            {% endfor %}
        </select>
        <button type="submit">Confirmar Cliente</button>
    </form>

    {% if cliente_id %}
        {% for servicio in servicios %}
            {% if loop.first %}
                <h3>Servicios del Cliente</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Servicio</th>
                            <th>Fecha Solicitud</th>
                            <th>Crear Cotización</th>
                            <th>Ver Cotizaciones</th>
                        </tr>
                    </thead>
                    <tbody>
            {% endif %}
                        <tr>
                            <td>{{ servicio.nombre_servicio }}</td>
                            <td>{{ servicio.fecha_solicitud.strftime('%d/%m/%Y') }}</td>
                            <td>
                                <a href="{{ url_for('cotizaciones.formulario_crear', servicio_id=servicio.id) }}">
                                    Crear Cotización
                                </a>
                            </td>
                            <td>
                                {% if servicio.cotizaciones_con_archivo %}
                                    <a href="{{ url_for('cotizaciones.ver_cotizaciones_servicio', servicio_id=servicio.id) }}">
                                        Ver Cotizaciones
                                    </a>
                                {% else %}
                                    <span>No hay cotizaciones</span>
                                {% endif %}
                            </td>
                        </tr>
            {% if loop.last %}
                    </tbody>
                </table>
            {% endif %}
        {% else %}
            <p>No hay servicios disponibles para este cliente.</p>
        {% endfor %}
    {% endif %}
{% endblock %}
